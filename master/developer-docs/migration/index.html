<!DOCTYPE html>
<html>
	<head>
	<base id="baseURL" href="/master/" />
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1, maximum-scale=10, user-scalable=yes" />
<meta name="apple-mobile-web-app-capable" content="yes" />
<meta name="apple-touch-fullscreen" content="yes" />
<link rel="icon" type="image/png" href="/img/favicon/favicon-16x16.png" sizes="16x16">
<meta name="msapplication-TileColor" content="#65d3f7">
<meta name="msapplication-TileImage" content="/img/favicon/mstile-150x150.png">

<title>Sunbird Elasticsearch migration to multi index</title>
<meta name="description" content="Sunbird Elasticsearch migration to multi index"/>

<meta http-equiv="cache-control" content="max-age=0" />
<meta http-equiv="cache-control" content="no-cache" />
<meta http-equiv="Cache-Control" content="no-store" />
<meta http-equiv="pragma" content="no-cache" />
<meta name="last-modified" content="2020-07-20 14:55:55 +0530">
<meta http-equiv="Expires" content="600" />

<!--Build Details-->
<meta name="buildVersion" content="" />
<meta name="buildNo" content="2601" />
<meta name="version" id="docsVersion" content="master" />
<!--/Build Details-->


<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,600,700" >
<link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons" >
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.4.0/css/font-awesome.min.css">
<link rel="stylesheet" href="/css/style.css?20072020"  />

<script type="text/javascript" src="https://code.jquery.com/jquery-2.1.3.min.js"></script>
<script type="text/javascript" src="/js/bootstrap.min.js?20072020"></script>
<script type="text/javascript" src="/js/jquery.tocLight.js?20072020"></script>
<script type="text/javascript" src="/js/jquery.elevateZoom-3.0.8.min.js?20072020"></script>
<script type="text/javascript" src="/js/handlebars-v4.0.11.js?20072020"></script>
<script type="text/javascript" src="/js/widgets-data.js?20072020"></script>
<script type="text/javascript" src="/js/widgets.js?20072020"></script>

<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-106552125-1"></script>
<script>
	window.dataLayer = window.dataLayer || [];
	function gtag(){dataLayer.push(arguments);}
	gtag('js', new Date());
	gtag('config', 'UA-106552125-1');
</script>
<script>
function resetBase(){
	currentURLArray = window.location.pathname.split( '/' );
    secondLevelLocation = currentURLArray[1];
    if (secondLevelLocation == 'latest'){
		baseURL = document.getElementById('baseURL');
		baseURL.href="/latest/";
	}
}
resetBase();
</script>

	
		<meta name="robots" content="index, follow">
	
  </head>
  <body id="body" class="doc-layout">
  <div class="container inner container-height docs">
    <header class="logo-container">
      <div class="logo">
        <a href="https://www.sunbird.org" target="_blank">
          <img src="/img/sunbird-logo.png" alt="Sunbird" title="Sunbird">
        </a>
      </div>
      <button type="button" class="dropdown-toggle collapsed" id="dropdown-trigger" data-toggle="collapse" data-target="#mobile-dropdown" aria-expanded="false">
        <i class="fa fa-bars" aria-hidden="true"></i>
      </button>
    </header>
    <nav class="sidebar-container" id="mobile-dropdown">
      <div class="inner__sidebar">
        

<div id="" class="sidebar-cover">
	
	 <div class="search-cover">
	<form method="get" action="https://www.google.com/search" target="_blank">
		<input type="text" value="" name="q" placeholder="Search"/ class="search-input" title="Enter keyword to search">
		<input type="hidden" value="en" name="hl" />
		<input type="hidden" name="sitesearch" value="http://docs.sunbird.org" />
		<input type="hidden" value="lang_en" name="lr" />
		<button type="submit" onclick="submit()" class="search-btn" title="Search">
			<i class="fa fa-search"></i>
		</button>
	</form>
</div>
 
	<div id="widgetVersionSwitcher"></div>
	
	<div class="sidebar-wrapper developer-docs"> 
		
			
				
				
				<div class="">
					<a href="architecture/" >
						<h4 class="sidebar-group-title">Architecture</h4>
					</a>
					
					<ul class="sidebar-group">
					
						<li>
							
								
								<a 
									href="architecture/overview/" 
									
									class="" 
									>
									Overview
								</a>
							
						</li>
					
						<li>
							
								
								<a 
									href="architecture/design/" 
									
									class="" 
									>
									Design
								</a>
							
						</li>
					
						<li>
							
								<div class="">
									
									<a 
										href="architecture/views/elementryview/" 
										 
										class="" 
										> 
										Views
									</a>
									<ul class="sidebar-group">
										
										<li>
											
											<a  
												href="architecture/views/logical/" 
												
												class="" 
												>
												Logical View
											</a>
											<ul class="sidebar-group">
												
											</ul>
										</li>
										
										<li>
											
											<a  
												href="architecture/views/physical/" 
												
												class="" 
												>
												Physical View
											</a>
											<ul class="sidebar-group">
												
											</ul>
										</li>
										
										<li>
											
											<a  
												href="architecture/views/conceptual/" 
												
												class="" 
												>
												Conceptual View
											</a>
											<ul class="sidebar-group">
												
											</ul>
										</li>
										
										<li>
											
											<a  
												href="architecture/views/deployment/" 
												
												class="" 
												>
												Deployment View
											</a>
											<ul class="sidebar-group">
												
											</ul>
										</li>
										
									</ul>
								</div>
							
						</li>
					
						<li>
							
								
								<a 
									href="architecture/usecase/" 
									
									class="" 
									>
									Use Cases
								</a>
							
						</li>
					
					</ul>
					
				</div>
			
				
				
				<div class="">
					<a href="features-documentation/" >
						<h4 class="sidebar-group-title">Product Features</h4>
					</a>
					
					<ul class="sidebar-group">
					
						<li>
							
								
								<a 
									href="features-documentation/explore_sunbird/" 
									
									class="" 
									>
									Explore Sunbird
								</a>
							
						</li>
					
						<li>
							
								
								<a 
									href="features-documentation/signup/" 
									
									class="" 
									>
									Sign Up
								</a>
							
						</li>
					
						<li>
							
								
								<a 
									href="features-documentation/login/" 
									
									class="" 
									>
									Sign In
								</a>
							
						</li>
					
						<li>
							
								
								<a 
									href="features-documentation/register_org/" 
									
									class="" 
									>
									Register Organizations
								</a>
							
						</li>
					
						<li>
							
								
								<a 
									href="features-documentation/register_user/" 
									
									class="" 
									>
									Register Users
								</a>
							
						</li>
					
						<li>
							
								<div class="">
									
									<a 
										href="features-documentation/userrolepermission/" 
										 
										class="" 
										> 
										User Roles and Permissions
									</a>
									<ul class="sidebar-group">
										
										<li>
											
											<a  
												href="features-documentation/userrole/" 
												
												class="" 
												>
												Types of Users
											</a>
											<ul class="sidebar-group">
												
											</ul>
										</li>
										
										<li>
											
											<a  
												href="features-documentation/userprofile/" 
												
												class="" 
												>
												User Profile
											</a>
											<ul class="sidebar-group">
												
											</ul>
										</li>
										
										<li>
											
											<a  
												href="features-documentation/workspace/" 
												
												class="" 
												>
												Workspace
											</a>
											<ul class="sidebar-group">
												
											</ul>
										</li>
										
									</ul>
								</div>
							
						</li>
					
						<li>
							
								
								<a 
									href="features-documentation/admindashboard/" 
									
									class="" 
									>
									Administrator Dashboard
								</a>
							
						</li>
					
						<li>
							
								
								<a 
									href="features-documentation/lessonplan/" 
									
									class="" 
									>
									Lesson Plan
								</a>
							
						</li>
					
						<li>
							
								
								<a 
									href="features-documentation/book_creation/" 
									
									class="" 
									>
									Book
								</a>
							
						</li>
					
						<li>
							
								
								<a 
									href="features-documentation/collection_creation/" 
									
									class="" 
									>
									Collection
								</a>
							
						</li>
					
						<li>
							
								
								<a 
									href="features-documentation/resource_creation/" 
									
									class="" 
									>
									Resource
								</a>
							
						</li>
					
						<li>
							
								<div class="">
									
									<a 
										href="features-documentation/course_intro/" 
										 
										class="" 
										> 
										Courses
									</a>
									<ul class="sidebar-group">
										
										<li>
											
											<a  
												href="features-documentation/course_creation/" 
												
												class="" 
												>
												Course Creation
											</a>
											<ul class="sidebar-group">
												
											</ul>
										</li>
										
										<li>
											
											<a  
												href="features-documentation/course_batches/" 
												
												class="" 
												>
												Batch Creation
											</a>
											<ul class="sidebar-group">
												
											</ul>
										</li>
										
										<li>
											
											<a  
												href="features-documentation/course_consumption/" 
												
												class="" 
												>
												Taking a Course
											</a>
											<ul class="sidebar-group">
												
											</ul>
										</li>
										
										<li>
											
											<a  
												href="features-documentation/course_unenroll/" 
												
												class="" 
												>
												Unenrolling from a Course
											</a>
											<ul class="sidebar-group">
												
											</ul>
										</li>
										
									</ul>
								</div>
							
						</li>
					
						<li>
							
								
								<a 
									href="features-documentation/upload/" 
									
									class="" 
									>
									Uploading Content
								</a>
							
						</li>
					
						<li>
							
								<div class="">
									
									<a 
										href="features-documentation/badging_framework/badging_overview/" 
										 
										class="" 
										> 
										Badging Framework
									</a>
									<ul class="sidebar-group">
										
										<li>
											
											<a  
												href="features-documentation/badging_framework/content_badges/" 
												
												class="" 
												>
												Issuing Badges for Content
											</a>
											<ul class="sidebar-group">
												
											</ul>
										</li>
										
									</ul>
								</div>
							
						</li>
					
						<li>
							
								
								<a 
									href="features-documentation/content_review/" 
									
									class="" 
									>
									Content Review
								</a>
							
						</li>
					
						<li>
							
								
								<a 
									href="features-documentation/announcement/" 
									
									class="" 
									>
									Announcement
								</a>
							
						</li>
					
						<li>
							
								
								<a 
									href="features-documentation/library/" 
									
									class="" 
									>
									Library
								</a>
							
						</li>
					
						<li>
							
								
								<a 
									href="features-documentation/contentlifecycle/" 
									
									class="" 
									>
									Content Lifecycle
								</a>
							
						</li>
					
						<li>
							
								
								<a 
									href="features-documentation/contenteditor/" 
									
									class="" 
									>
									Content Editor
								</a>
							
						</li>
					
						<li>
							
								<div class="">
									
									<a 
										href="features-documentation/guidelines/" 
										 
										class="" 
										> 
										Guidelines
									</a>
									<ul class="sidebar-group">
										
										<li>
											
											<a  
												href="features-documentation/intellectualproperty/" 
												
												class="" 
												>
												Intellectual Property
											</a>
											<ul class="sidebar-group">
												
											</ul>
										</li>
										
									</ul>
								</div>
							
						</li>
					
						<li>
							
								
								<a 
									href="features-documentation/collaborationpartnership/" 
									
									class="" 
									>
									Collaboration and Partnership
								</a>
							
						</li>
					
						<li>
							
								
								<a 
									href="features-documentation/mobileapp/allappfeatures/" 
									
									class="" 
									>
									Mobile App Features
								</a>
							
						</li>
					
					</ul>
					
				</div>
			
				
				
				<div class="">
					<a href="usertaskflow/" >
						<h4 class="sidebar-group-title">User Task Flows</h4>
					</a>
					
					<ul class="sidebar-group">
					
						<li>
							
								
								<a 
									href="usertaskflow/how_do_i_create_content/" 
									
									class="" 
									>
									How do I Create Content
								</a>
							
						</li>
					
						<li>
							
								
								<a 
									href="usertaskflow/how_do_i_add_video/" 
									
									class="" 
									>
									How do I Add a Video
								</a>
							
						</li>
					
						<li>
							
								
								<a 
									href="usertaskflow/how_do_i_add_text/" 
									
									class="" 
									>
									How do I Add Text
								</a>
							
						</li>
					
						<li>
							
								
								<a 
									href="usertaskflow/how_do_i_add_audio/" 
									
									class="" 
									>
									How do I Add Audio
								</a>
							
						</li>
					
						<li>
							
								
								<a 
									href="usertaskflow/how_do_i_add_hotspot/" 
									
									class="" 
									>
									How do I Add a Hotspot
								</a>
							
						</li>
					
						<li>
							
								
								<a 
									href="usertaskflow/how_do_i_add_image/" 
									
									class="" 
									>
									How do I Add an Image
								</a>
							
						</li>
					
						<li>
							
								
								<a 
									href="usertaskflow/how_do_i_add_shape/" 
									
									class="" 
									>
									How do I Add Shapes
								</a>
							
						</li>
					
						<li>
							
								
								<a 
									href="usertaskflow/how_do_i_add_scribblepad/" 
									
									class="" 
									>
									How do I Add the Scribblepad
								</a>
							
						</li>
					
						<li>
							
								
								<a 
									href="usertaskflow/how_do_i_add_activity/" 
									
									class="" 
									>
									How do I Add an Activity
								</a>
							
						</li>
					
						<li>
							
								
								<a 
									href="usertaskflow/how_do_i_create_course/" 
									
									class="" 
									>
									How do I Create a Course
								</a>
							
						</li>
					
						<li>
							
								
								<a 
									href="usertaskflow/how_do_i_create_book/" 
									
									class="" 
									>
									How do I Create a Book
								</a>
							
						</li>
					
						<li>
							
								
								<a 
									href="usertaskflow/how_do_i_create_book_with_dial_code/" 
									
									class="" 
									>
									How do I Add DIAL Codes to a Book
								</a>
							
						</li>
					
						<li>
							
								
								<a 
									href="usertaskflow/how_do_i_create_lessonplan/" 
									
									class="" 
									>
									How do I Create a Lesson Plan
								</a>
							
						</li>
					
						<li>
							
								
								<a 
									href="usertaskflow/how_do_i_create_collection/" 
									
									class="" 
									>
									How do I Create a Collection
								</a>
							
						</li>
					
						<li>
							
								
								<a 
									href="usertaskflow/reviewer_taskflow/" 
									
									class="" 
									>
									How do I Review Content
								</a>
							
						</li>
					
						<li>
							
								
								<a 
									href="usertaskflow/how_do_i_uploadcontent/" 
									
									class="" 
									>
									How do I Upload Content
								</a>
							
						</li>
					
						<li>
							
								
								<a 
									href="usertaskflow/how_do_i_delete_content/" 
									
									class="" 
									>
									How do I Delete Content
								</a>
							
						</li>
					
						<li>
							
								
								<a 
									href="usertaskflow/how_do_i_add_metadata/" 
									
									class="" 
									>
									How do I Add Metadata
								</a>
							
						</li>
					
						<li>
							
								
								<a 
									href="usertaskflow/how_do_i_add_resource/" 
									
									class="" 
									>
									How do I Add Resource
								</a>
							
						</li>
					
						<li>
							
								
								<a 
									href="usertaskflow/limited_sharing/" 
									
									class="" 
									>
									How do I Share Content to a Limited Group
								</a>
							
						</li>
					
					</ul>
					
				</div>
			
				
				
				<div class="active">
					<a href="developer-docs/" >
						<h4 class="sidebar-group-title">Developer Documentation</h4>
					</a>
					
					<ul class="sidebar-group">
					
						<li>
							
								<div class="">
									
									<a 
										href="developer-docs/server-installation/" 
										 
										class="" 
										> 
										Server Installation
									</a>
									<ul class="sidebar-group">
										
										<li>
											
											<a  
												href="developer-docs/server-installation/prerequisites/" 
												
												class="" 
												>
												Prerequisites
											</a>
											<ul class="sidebar-group">
												
											</ul>
										</li>
										
										<li>
											
											<a  
												href="developer-docs/server-installation/load_balancer_setup/" 
												
												class="" 
												>
												Load Balancer Setup
											</a>
											<ul class="sidebar-group">
												
											</ul>
										</li>
										
										<li>
											
											<a  
												href="developer-docs/server-installation/ansible-variables/" 
												
												class="" 
												>
												Ansible Variables Setup
											</a>
											<ul class="sidebar-group">
												
											</ul>
										</li>
										
										<li>
											
											<a  
												href="developer-docs/server-installation/jenkins-setup/" 
												
												class="" 
												>
												Jenkins Setup
											</a>
											<ul class="sidebar-group">
												
											</ul>
										</li>
										
										<li>
											
											<a  
												href="developer-docs/server-installation/understanding-jenkins-scripts-jobs-parameters-and-variables/" 
												
												class="" 
												>
												Understanding Jenkins Scripts
											</a>
											<ul class="sidebar-group">
												
											</ul>
										</li>
										
										<li>
											
											<a  
												href="developer-docs/server-installation/running-build-artifact-uploads-and-deployments/" 
												
												class="" 
												>
												Running Builds, Artifact Uploads and Deployments
											</a>
											<ul class="sidebar-group">
												
													<li>
														
														<a  
															href="developer-docs/server-installation/artifactupload-job/" 
															
															class="" 
															>
															Artifact Upload Jobs
														</a>
													</li>
												
													<li>
														
														<a  
															href="developer-docs/server-installation/knowledge-platform/" 
															
															class="" 
															>
															Knowledge Platform
														</a>
													</li>
												
													<li>
														
														<a  
															href="developer-docs/server-installation/data-pipeline/" 
															
															class="" 
															>
															Data Pipeline
														</a>
													</li>
												
													<li>
														
														<a  
															href="developer-docs/server-installation/core-services/" 
															
															class="" 
															>
															Core Services
														</a>
													</li>
												
													<li>
														
														<a  
															href="developer-docs/server-installation/plugins/" 
															
															class="" 
															>
															Plugins
														</a>
													</li>
												
											</ul>
										</li>
										
										<li>
											
											<a  
												href="developer-docs/server-installation/jenkins-tweaks/" 
												
												class="" 
												>
												Jenkins Tweaks
											</a>
											<ul class="sidebar-group">
												
											</ul>
										</li>
										
										<li>
											
											<a  
												href="developer-docs/server-installation/keycloak_user_federation/" 
												
												class="" 
												>
												Keycloak User Federation
											</a>
											<ul class="sidebar-group">
												
											</ul>
										</li>
										
										<li>
											
											<a  
												href="developer-docs/server-installation/post_installation_configuration/" 
												
												class="" 
												>
												Post Installation Configuration
											</a>
											<ul class="sidebar-group">
												
											</ul>
										</li>
										
									</ul>
								</div>
							
						</li>
					
						<li>
							
								<div class="">
									
									<a 
										href="developer-docs/server-configurations/" 
										 
										class="" 
										> 
										Server Configurations
									</a>
									<ul class="sidebar-group">
										
										<li>
											
											<a  
												href="developer-docs/server-configurations/env_variables_portal/" 
												
												class="" 
												>
												Portal Service Environment Variables
											</a>
											<ul class="sidebar-group">
												
											</ul>
										</li>
										
										<li>
											
											<a  
												href="developer-docs/server-configurations/env_variables_content_service/" 
												
												class="" 
												>
												Content Service Environment Variables
											</a>
											<ul class="sidebar-group">
												
													<li>
														
														<a  
															href="developer-docs/server-configurations/configuring_domain_ext_links/" 
															
															class="" 
															>
															Import External Content
														</a>
													</li>
												
													<li>
														
														<a  
															href="developer-docs/server-configurations/content_filtering/" 
															
															class="" 
															>
															Content Filtering
														</a>
													</li>
												
											</ul>
										</li>
										
										<li>
											
											<a  
												href="developer-docs/server-configurations/system_settings/" 
												
												class="" 
												>
												System Settings
											</a>
											<ul class="sidebar-group">
												
											</ul>
										</li>
										
										<li>
											
											<a  
												href="developer-docs/server-configurations/configuring_email_notification/" 
												
												class="" 
												>
												Email Notification Configuration
											</a>
											<ul class="sidebar-group">
												
											</ul>
										</li>
										
										<li>
											
											<a  
												href="developer-docs/server-configurations/content_checklist_configuration/" 
												
												class="" 
												>
												Reviewer Checklist
											</a>
											<ul class="sidebar-group">
												
											</ul>
										</li>
										
										<li>
											
											<a  
												href="developer-docs/server-configurations/metadata_driven_forms/" 
												
												class="" 
												>
												Metaforms Configuration
											</a>
											<ul class="sidebar-group">
												
											</ul>
										</li>
										
										<li>
											
											<a  
												href="developer-docs/server-configurations/env_variables_lms/" 
												
												class="" 
												>
												LMS Service Environment Variables
											</a>
											<ul class="sidebar-group">
												
													<li>
														
														<a  
															href="developer-docs/server-configurations/sso_otpsms/" 
															
															class="" 
															>
															OTP based SMS Configuration
														</a>
													</li>
												
													<li>
														
														<a  
															href="developer-docs/server-configurations/keycloak_admin_config_settings/" 
															
															class="" 
															>
															Keycloak Admin Configuration
														</a>
													</li>
												
											</ul>
										</li>
										
									</ul>
								</div>
							
						</li>
					
						<li>
							
								<div class="">
									
									<a 
										href="developer-docs/developer-installation/" 
										 
										class="" 
										> 
										Developer Installation
									</a>
									<ul class="sidebar-group">
										
										<li>
											
											<a  
												href="developer-docs/developer-installation/install_sbportal" 
												
												class="" 
												>
												Portal
											</a>
											<ul class="sidebar-group">
												
											</ul>
										</li>
										
									</ul>
								</div>
							
						</li>
					
						<li>
							
								<div class="">
									
									<a 
										href="developer-docs/mobile-app-installation/" 
										 
										class="" 
										> 
										Mobile App Installation
									</a>
									<ul class="sidebar-group">
										
										<li>
											
											<a  
												href="developer-docs/mobile-app-installation/mobile_app_forms" 
												
												class="" 
												>
												Mobile App forms
											</a>
											<ul class="sidebar-group">
												
											</ul>
										</li>
										
									</ul>
								</div>
							
						</li>
					
						<li>
							
								<div class="">
									
									<a 
										href="developer-docs/upgrade/" 
										 
										class="" 
										> 
										Upgrading Sunbird
									</a>
									<ul class="sidebar-group">
										
										<li>
											
											<a  
												href="developer-docs/upgrade/jenkins_updates/" 
												
												class="" 
												>
												Update Jenkins
											</a>
											<ul class="sidebar-group">
												
											</ul>
										</li>
										
										<li>
											
											<a  
												href="developer-docs/upgrade/update_ansible_variables/" 
												
												class="" 
												>
												Update Ansible Variables
											</a>
											<ul class="sidebar-group">
												
											</ul>
										</li>
										
										<li>
											
											<a  
												href="developer-docs/upgrade/build_n_deploy/" 
												
												class="" 
												>
												Build and Deploy
											</a>
											<ul class="sidebar-group">
												
											</ul>
										</li>
										
									</ul>
								</div>
							
						</li>
					
						<li>
							
								<div class="">
									
									<a 
										href="developer-docs/onboarding/" 
										 
										class="" 
										> 
										Onboarding
									</a>
									<ul class="sidebar-group">
										
										<li>
											
											<a  
												href="developer-docs/singlesignon/org_user_creation_sso/" 
												
												class="" 
												>
												Creating Organizations and Users
											</a>
											<ul class="sidebar-group">
												
											</ul>
										</li>
										
										<li>
											
											<a  
												href="features-documentation/badging_framework/creating_badges/" 
												
												class="" 
												>
												Creating Badges
											</a>
											<ul class="sidebar-group">
												
											</ul>
										</li>
										
										<li>
											
											<a  
												href="features-documentation/badging_framework/badges_users/" 
												
												class="" 
												>
												Issuing Badges to Users
											</a>
											<ul class="sidebar-group">
												
											</ul>
										</li>
										
										<li>
											
											<a  
												href="developer-docs/configuring_sunbird/configuring_announcement/" 
												
												class="" 
												>
												Creating Announcements
											</a>
											<ul class="sidebar-group">
												
											</ul>
										</li>
										
									</ul>
								</div>
							
						</li>
					
						<li>
							
								<div class="">
									
									<a 
										href="developer-docs/how-to-guide/overview_howto/" 
										 
										class="" 
										> 
										How-To-Guides
									</a>
									<ul class="sidebar-group">
										
										<li>
											
											<a  
												href="developer-docs/how-to-guide/how_to_create_framework_in_sunbird/" 
												
												class="" 
												>
												Creating Framework
											</a>
											<ul class="sidebar-group">
												
											</ul>
										</li>
										
										<li>
											
											<a  
												href="developer-docs/how-to-guide/how_to_seeddata_in_framework/" 
												
												class="" 
												>
												Adding Content to Framework
											</a>
											<ul class="sidebar-group">
												
											</ul>
										</li>
										
										<li>
											
											<a  
												href="developer-docs/how-to-guide/how_to_create_organization/" 
												
												class="" 
												>
												Creating Organizations
											</a>
											<ul class="sidebar-group">
												
											</ul>
										</li>
										
										<li>
											
											<a  
												href="developer-docs/how-to-guide/how_to_create_user/" 
												
												class="" 
												>
												Creating Users
											</a>
											<ul class="sidebar-group">
												
											</ul>
										</li>
										
										<li>
											
											<a  
												href="developer-docs/how-to-guide/how_to_create_org_add_user/" 
												
												class="" 
												>
												Adding User to Organization
											</a>
											<ul class="sidebar-group">
												
											</ul>
										</li>
										
										<li>
											
											<a  
												href="developer-docs/how-to-guide/how_to_create_course_using_api/" 
												
												class="" 
												>
												Creating Course
											</a>
											<ul class="sidebar-group">
												
											</ul>
										</li>
										
										<li>
											
											<a  
												href="developer-docs/how-to-guide/how_to_upload_existing_content/" 
												
												class="" 
												>
												Uploading Content
											</a>
											<ul class="sidebar-group">
												
											</ul>
										</li>
										
										<li>
											
											<a  
												href="developer-docs/how-to-guide/how_to_create_badge/" 
												
												class="" 
												>
												Creating Badges
											</a>
											<ul class="sidebar-group">
												
											</ul>
										</li>
										
										<li>
											
											<a  
												href="developer-docs/how-to-guide/metadata_driven_forms" 
												
												class="" 
												>
												Configuring Metaforms
											</a>
											<ul class="sidebar-group">
												
											</ul>
										</li>
										
										<li>
											
											<a  
												href="developer-docs/how-to-guide/link_dial_code_to_a_book" 
												
												class="" 
												>
												Linking DIAL Code
											</a>
											<ul class="sidebar-group">
												
											</ul>
										</li>
										
										<li>
											
											<a  
												href="developer-docs/how-to-guide/telemetry_data_consumption" 
												
												class="" 
												>
												Consuming Telemetry Data
											</a>
											<ul class="sidebar-group">
												
											</ul>
										</li>
										
										<li>
											
											<a  
												href="developer-docs/how-to-guide/sync_telemetry_data_captured_from_offline_devices" 
												
												class="" 
												>
												Syncing Telemetry Data
											</a>
											<ul class="sidebar-group">
												
											</ul>
										</li>
										
									</ul>
								</div>
							
						</li>
					
						<li>
							
								<div class="">
									
									<a 
										href="developer-docs/telemetry/overview/" 
										 
										class="" 
										> 
										Telemetry
									</a>
									<ul class="sidebar-group">
										
										<li>
											
											<a  
												href="developer-docs/telemetry/specification/" 
												
												class="" 
												>
												Telemetry Specifications
											</a>
											<ul class="sidebar-group">
												
											</ul>
										</li>
										
										<li>
											
											<a  
												href="developer-docs/telemetry/sending_telemetry/" 
												
												class="" 
												>
												Sending Telemetry
											</a>
											<ul class="sidebar-group">
												
											</ul>
										</li>
										
										<li>
											
											<a  
												href="developer-docs/telemetry/consuming_telemetry/" 
												
												class="" 
												>
												Consuming Telemetry Data
											</a>
											<ul class="sidebar-group">
												
													<li>
														
														<a  
															href="developer-docs/telemetry/consuming_telemetry/#mobile-app-workflow" 
															
															class="" 
															>
															Mobile App Workflow
														</a>
													</li>
												
													<li>
														
														<a  
															href="developer-docs/telemetry/consuming_telemetry/#web-portal-workflow" 
															
															class="" 
															>
															Web Portal Workflow
														</a>
													</li>
												
													<li>
														
														<a  
															href="developer-docs/telemetry/consuming_telemetry/#content-editor-workflow" 
															
															class="" 
															>
															Content Editor Workflow
														</a>
													</li>
												
													<li>
														
														<a  
															href="developer-docs/telemetry/consuming_telemetry/#backend-services-workflow" 
															
															class="" 
															>
															Backend-services Workflow
														</a>
													</li>
												
											</ul>
										</li>
										
									</ul>
								</div>
							
						</li>
					
						<li>
							
								<div class="">
									
									<a 
										href="developer-docs/library_reference/" 
										 
										class="" 
										> 
										Library References
									</a>
									<ul class="sidebar-group">
										
										<li>
											
											<a  
												href="developer-docs/telemetry/jslibrary/" 
												
												class="" 
												>
												Standalone JS Library
											</a>
											<ul class="sidebar-group">
												
											</ul>
										</li>
										
										<li>
											
											<a  
												href="developer-docs/telemetry/htmlinterfacelibrary/" 
												
												class="" 
												>
												HTML Interface Library
											</a>
											<ul class="sidebar-group">
												
											</ul>
										</li>
										
										<li>
											
											<a  
												href="developer-docs/telemetry/authtokengenerator_jslibrary/" 
												
												class="" 
												>
												AuthToken Generator JS Library
											</a>
											<ul class="sidebar-group">
												
											</ul>
										</li>
										
									</ul>
								</div>
							
						</li>
					
						<li>
							
								
								<a 
									href="developer-docs/troubleshooting/" 
									
									class="" 
									>
									Troubleshooting
								</a>
							
						</li>
					
					</ul>
					
				</div>
			
				
				
				<div class="">
					<a href="apis/" >
						<h4 class="sidebar-group-title">API Reference Documentation</h4>
					</a>
					
					<ul class="sidebar-group">
					
						<li>
							
								
								<a 
									href="apis/#feature" 
									
									class="" 
									>
									Feature
								</a>
							
						</li>
					
						<li>
							
								
								<a 
									href="apis/#admin-apis" 
									
									class="" 
									>
									Administration
								</a>
							
						</li>
					
						<li>
							
								
								<a 
									href="apis/#setup-apis" 
									
									class="" 
									>
									Setup
								</a>
							
						</li>
					
						<li>
							
								
								<a 
									href="apis/#data-apis" 
									
									class="" 
									>
									Data
								</a>
							
						</li>
					
					</ul>
					
				</div>
			
				
				
				<div class="">
					<a href="/contributions/" >
						<h4 class="sidebar-group-title">Contribute to Sunbird</h4>
					</a>
					
					<ul class="sidebar-group">
					
						<li>
							
								
								<a 
									href="/contributions/filing_a_bug" 
									
									class="" 
									>
									Guidelines for Filing a Bug
								</a>
							
						</li>
					
						<li>
							
								
								<a 
									href="/contributions/contribution_guidelines" 
									
									class="" 
									>
									Contributing to Sunbird Documentation
								</a>
							
						</li>
					
					</ul>
					
				</div>
			
				
				
				<div class="">
					<a href="release_notes/" >
						<h4 class="sidebar-group-title">Release Notes</h4>
					</a>
					
				</div>
			
				
				
				<div class="">
					<a href="faqs/" >
						<h4 class="sidebar-group-title">Frequently asked questions</h4>
					</a>
					
					<ul class="sidebar-group">
					
						<li>
							
								
								<a 
									href="faqs/audience/" 
									
									class="" 
									>
									Audience
								</a>
							
						</li>
					
						<li>
							
								
								<a 
									href="faqs/content_format/" 
									
									class="" 
									>
									Content Format
								</a>
							
						</li>
					
						<li>
							
								
								<a 
									href="faqs/content_repo/" 
									
									class="" 
									>
									Content Repositories
								</a>
							
						</li>
					
						<li>
							
								
								<a 
									href="faqs/contentreviews/" 
									
									class="" 
									>
									Content Review
								</a>
							
						</li>
					
						<li>
							
								
								<a 
									href="faqs/content_types/" 
									
									class="" 
									>
									Content Types
								</a>
							
						</li>
					
						<li>
							
								
								<a 
									href="faqs/content_upload/" 
									
									class="" 
									>
									Content Upload
								</a>
							
						</li>
					
						<li>
							
								
								<a 
									href="faqs/feature/" 
									
									class="" 
									>
									Features
								</a>
							
						</li>
					
						<li>
							
								
								<a 
									href="faqs/fixerrors/" 
									
									class="" 
									>
									Fix Errors
								</a>
							
						</li>
					
						<li>
							
								
								<a 
									href="faqs/helpsupport/" 
									
									class="" 
									>
									Help Support
								</a>
							
						</li>
					
						<li>
							
								
								<a 
									href="faqs/intellectual_propertylicensesstandards/" 
									
									class="" 
									>
									Intellectual Property Licenses Standards
								</a>
							
						</li>
					
						<li>
							
								
								<a 
									href="faqs/registrationenrolment/" 
									
									class="" 
									>
									Registration and Enrollment
								</a>
							
						</li>
					
						<li>
							
								
								<a 
									href="faqs/signin/" 
									
									class="" 
									>
									Sign In
								</a>
							
						</li>
					
						<li>
							
								
								<a 
									href="faqs/taxonomymetadataframework/" 
									
									class="" 
									>
									Taxonomy Metadata Framework
								</a>
							
						</li>
					
						<li>
							
								
								<a 
									href="faqs/user_rightspermissions/" 
									
									class="" 
									>
									Users Rights and Permission
								</a>
							
						</li>
					
					</ul>
					
				</div>
			
				
				
				<div class="">
					<a href="glossary/" >
						<h4 class="sidebar-group-title">Glossary</h4>
					</a>
					
				</div>
				
		
	</div>
</div>

<script>
	$("a[href$='developer-docs/migration/']").addClass("sidebar-link-selected");
</script>

      </div>
    </nav>
    <div class="content">
      <div class="inner__content header" id="heading">
        <h1>Sunbird Elasticsearch migration to multi index </h1>
      </div>

      <div id="main-content" class="inner__content">
			<p class="edit-para text-right">
				<span>
			<!--<a target="_blank" class="contribute" href="/contributions/contribution_guidelines/">
				  <i class="fa fa-book" aria-hidden="true"></i> <i>Contribution Guidelines</i>
			  </a> &nbsp;&nbsp;-->
			  
			 <a target="_blank"  title="Edit this page"class="" href="https://github.com/project-sunbird/sunbird.org-docs/edit/master/developer-docs/migration/index.md">
				  <i class="fa fa-pencil-square-o" aria-hidden="true"></i> Edit
			  </a> 
			  | 
			  <a target="_blank" href="https://github.com/project-sunbird/sunbird.org-docs/issues" title="Report issue">
				  <i class="fa fa-exclamation-circle" aria-hidden="true"></i>
				  Report
			  </a>
			  </span>
			</p>
			<div class="widgetLatestVersionNotification"></div>
          <div id="toc-container">
  <table class="toc" id="toc">
    <tbody>
      <tr>
        <td>
          <div id="toctitle">
            <h2>Contents</h2>
            <span class="toctoggle">[<a id="toctogglelink" class="internal" href="#">hide</a>]</span>
          </div>
          <ul>
            <li class="toc_level-1 toc_section-1">
              <a href="#overview"><span class="tocnumber">1 .</span> <span class="toctext">Overview</span></a>
              <ul>
                <li class="toc_level-2 toc_section-2">
                  <a href="#steps"><span class="tocnumber">1.1 .</span> <span class="toctext">Steps</span></a>
                </li>
                <li class="toc_level-2 toc_section-3">
                  <a href="#prepare-the-mapping-as-input-to-create-index"><span class="tocnumber">1.2 .</span> <span class="toctext">Prepare the mapping as input to create index</span></a>
                </li>
                <li class="toc_level-2 toc_section-4">
                  <a href="#creating-indexes-through-curl-commands"><span class="tocnumber">1.3 .</span> <span class="toctext">Creating indexes through cURL commands</span></a>
                </li>
                <li class="toc_level-2 toc_section-5">
                  <a href="#migrate-old-index-data"><span class="tocnumber">1.4 .</span> <span class="toctext">Migrate old index data</span></a>
                </li>
                <li class="toc_level-2 toc_section-6">
                  <a href="#pros-and-cons"><span class="tocnumber">1.5 .</span> <span class="toctext">Pros and Cons</span></a>
                </li>
                <li class="toc_level-2 toc_section-7">
                  <a href="#reindex-api-to-migrate-data"><span class="tocnumber">1.6 .</span> <span class="toctext">Reindex API to migrate data</span></a>
                </li>
                <li class="toc_level-2 toc_section-8">
                  <a href="#additional-details"><span class="tocnumber">1.7 .</span> <span class="toctext">Additional details</span></a>
                </li>
                <li class="toc_level-2 toc_section-9">
                  <a href="#open-questions"><span class="tocnumber">1.8 .</span> <span class="toctext">Open Questions</span></a>
                </li>
              </ul>
            </li>
          </ul>
        </td>
      </tr>
    </tbody>
  </table>
</div><h2 id="overview">Overview</h2>

<p>Since multiple types are deprecated for Elasticsearch 6.x, There is no way to create a new index with multiple type other than migration from older version. This creates challenges as below.</p>

<ul>
  <li>New adopters cannot have sunbird in it’s current state.</li>
  <li>Old static mapping update call doesn’t work on migrated index with multiple types.</li>
</ul>

<p>The document concentrates on multi index approach. The multi index approach is divided into three parts</p>

<ul>
  <li>Create new indexes with the settings and mappings from old indexes</li>
  <li>Migration of data of old indexes with each type into separate indexes of single type.</li>
  <li>Code changes to point to different indexes in different flows</li>
</ul>

<h3 id="steps">Steps</h3>

<p>For creating new index with original settings and mappings, first we need to get the settings and mappings of the old indices and then we use that setting and mappings to create new index</p>

<h4 id="setting-an-index">Setting an index</h4>

<pre>
  <code>get index setting

    Request
    GET /{indexName}/_settings
    
    Response
    
    {
    "searchindex" : {
        "settings" : {
        "index" : {
            "number_of_shards" : "5",
            "provided_name" : "searchindex",
            "creation_date" : "1540294977064",
            "analysis" : {
            "filter" : {
                "mynGram" : {
                "token_chars" : [
                    "letter",
                    "digit",
                    "whitespace",
                    "punctuation",
                    "symbol"
                ],
                "min_gram" : "1",
                "type" : "ngram",
                "max_gram" : "20"
                }
            },
            "analyzer" : {
                "cs_index_analyzer" : {
                "filter" : [
                    "lowercase",
                    "mynGram"
                ],
                "type" : "custom",
                "tokenizer" : "standard"
                },
                "keylower" : {
                "filter" : "lowercase",
                "type" : "custom",
                "tokenizer" : "keyword"
                },
                "cs_search_analyzer" : {
                "filter" : [
                    "lowercase",
                    "standard"
                ],
                "type" : "custom",
                "tokenizer" : "standard"
                }
            }
            },
            "number_of_replicas" : "1",
            "uuid" : "HtjuANPTQH6Q3s4T9wTG3Q",
            "version" : {
            "created" : "5010199",
            "upgraded" : "6030099"
            }
        }
        }
    }
    }
    
    example
    
    curl -X GET http://11.2.3.58:9200/searchindex/_settings
</code>
</pre>

<p>With the response we need to prepare the settings for new indexes, copying the analysis and analyzer field and ignoring index specific fields like uuid, provided_name etc.</p>

<h4 id="mapping-the-index-type">Mapping the index type</h4>

<pre>
  <code>get index type mapping

    Request
    GET /{indexName}/_mapping/{type}
    

    Response
    
    {"searchindex":{"mappings":{"user":{"_all":{"enabled":true},"dynamic_templates":[{"longs":{"match_mapping_type":"long","mapping":{"fields":{"raw":{"type":"long"}},"type":"long"}}},{"booleans":{"match_mapping_type":"boolean","mapping":{"fields":{"raw":{"type":"boolean"}},"type":"boolean"}}},{"doubles":{"match_mapping_type":"double","mapping":{"fields":{"raw":{"type":"double"}},"type":"double"}}},{"dates":{"match_mapping_type":"date","mapping":{"fields":{"raw":{"type":"date"}},"type":"date"}}},{"strings":{"match_mapping_type":"string","mapping":{"analyzer":"cs_index_analyzer","copy_to":"all_fields","fielddata":true,"fields":{"raw":{"type":"text","fielddata":true,"analyzer":"keylower"}},"search_analyzer":"cs_search_analyzer","type":"text"}}}],"properties":{"all_fields":{"type":"text","fields":{"raw":{"type":"text","analyzer":"keylower"}},"analyzer":"cs_index_analyzer","search_analyzer":"cs_search_analyzer"},"channel":{"type":"text","fields":{"raw":{"type":"text","analyzer":"keylower","fielddata":true}},"copy_to":["all_fields"],"analyzer":"cs_index_analyzer","search_analyzer":"cs_search_analyzer","fielddata":true},"completeness":{"type":"long","fields":{"raw":{"type":"long"}}},"countryCode":{"type":"text","fields":{"raw":{"type":"text","analyzer":"keylower","fielddata":true}},"copy_to":["all_fields"],"analyzer":"cs_index_analyzer","search_analyzer":"cs_search_analyzer","fielddata":true},"createdBy":{"type":"text","fields":{"raw":{"type":"text","analyzer":"keylower","fielddata":true}},"copy_to":["all_fields"],"analyzer":"cs_index_analyzer","search_analyzer":"cs_search_analyzer","fielddata":true},"createdDate":{"type":"text","fields":{"raw":{"type":"text","analyzer":"keylower","fielddata":true}},"copy_to":["all_fields"],"analyzer":"cs_index_analyzer","search_analyzer":"cs_search_analyzer","fielddata":true},"dob":{"type":"date","fields":{"raw":{"type":"date"}}},"email":{"type":"text","fields":{"raw":{"type":"text","analyzer":"keylower","fielddata":true}},"copy_to":["all_fields"],"analyzer":"cs_index_analyzer","search_analyzer":"cs_search_analyzer","fielddata":true},"emailVerified":{"type":"boolean","fields":{"raw":{"type":"boolean"}}},"encEmail":{"type":"text","fields":{"raw":{"type":"text","analyzer":"keylower","fielddata":true}},"copy_to":["all_fields"],"analyzer":"cs_index_analyzer","search_analyzer":"cs_search_analyzer","fielddata":true},"encPhone":{"type":"text","fields":{"raw":{"type":"text","analyzer":"keylower","fielddata":true}},"copy_to":["all_fields"],"analyzer":"cs_index_analyzer","search_analyzer":"cs_search_analyzer","fielddata":true},"firstName":{"type":"text","fields":{"raw":{"type":"text","analyzer":"keylower","fielddata":true}},"copy_to":["all_fields"],"analyzer":"cs_index_analyzer","search_analyzer":"cs_search_analyzer","fielddata":true},"framework":{"type":"object"},"gender":{"type":"text","fields":{"raw":{"type":"text","analyzer":"keylower","fielddata":true}},"copy_to":["all_fields"],"analyzer":"cs_index_analyzer","search_analyzer":"cs_search_analyzer","fielddata":true},"id":{"type":"text","fields":{"raw":{"type":"text","analyzer":"keylower","fielddata":true}},"copy_to":["all_fields"],"analyzer":"cs_index_analyzer","search_analyzer":"cs_search_analyzer","fielddata":true},"identifier":{"type":"text","fields":{"raw":{"type":"text","analyzer":"keylower","fielddata":true}},"copy_to":["all_fields"],"analyzer":"cs_index_analyzer","search_analyzer":"cs_search_analyzer","fielddata":true},"isDeleted":{"type":"boolean","fields":{"raw":{"type":"boolean"}}},"language":{"type":"text","fields":{"raw":{"type":"text","analyzer":"keylower","fielddata":true}},"copy_to":["all_fields"],"analyzer":"cs_index_analyzer","search_analyzer":"cs_search_analyzer","fielddata":true},"lastName":{"type":"text","fields":{"raw":{"type":"text","analyzer":"keylower","fielddata":true}},"copy_to":["all_fields"],"analyzer":"cs_index_analyzer","search_analyzer":"cs_search_analyzer","fielddata":true},"loginId":{"type":"text","fields":{"raw":{"type":"text","analyzer":"keylower","fielddata":true}},"copy_to":["all_fields"],"analyzer":"cs_index_analyzer","search_analyzer":"cs_search_analyzer","fielddata":true},"maskedEmail":{"type":"text","fields":{"raw":{"type":"text","analyzer":"keylower","fielddata":true}},"copy_to":["all_fields"],"analyzer":"cs_index_analyzer","search_analyzer":"cs_search_analyzer","fielddata":true},"missingFields":{"type":"text","fields":{"raw":{"type":"text","analyzer":"keylower","fielddata":true}},"copy_to":["all_fields"],"analyzer":"cs_index_analyzer","search_analyzer":"cs_search_analyzer","fielddata":true},"organisations":{"properties":{"approvalDate":{"type":"text","fields":{"raw":{"type":"text","analyzer":"keylower","fielddata":true}},"copy_to":["all_fields"],"analyzer":"cs_index_analyzer","search_analyzer":"cs_search_analyzer","fielddata":true},"approvaldate":{"type":"text","fields":{"raw":{"type":"text","analyzer":"keylower","fielddata":true}},"copy_to":["all_fields"],"analyzer":"cs_index_analyzer","search_analyzer":"cs_search_analyzer","fielddata":true},"hashTagId":{"type":"text","fields":{"raw":{"type":"text","analyzer":"keylower","fielddata":true}},"copy_to":["all_fields"],"analyzer":"cs_index_analyzer","search_analyzer":"cs_search_analyzer","fielddata":true},"id":{"type":"text","fields":{"raw":{"type":"text","analyzer":"keylower","fielddata":true}},"copy_to":["all_fields"],"analyzer":"cs_index_analyzer","search_analyzer":"cs_search_analyzer","fielddata":true},"isApproved":{"type":"boolean","fields":{"raw":{"type":"boolean"}}},"isDeleted":{"type":"boolean","fields":{"raw":{"type":"boolean"}}},"isRejected":{"type":"boolean","fields":{"raw":{"type":"boolean"}}},"orgJoinDate":{"type":"text","fields":{"raw":{"type":"text","analyzer":"keylower","fielddata":true}},"copy_to":["all_fields"],"analyzer":"cs_index_analyzer","search_analyzer":"cs_search_analyzer","fielddata":true},"orgName":{"type":"text","fields":{"raw":{"type":"text","analyzer":"keylower","fielddata":true}},"copy_to":["all_fields"],"analyzer":"cs_index_analyzer","search_analyzer":"cs_search_analyzer","fielddata":true},"organisationId":{"type":"text","fields":{"raw":{"type":"text","analyzer":"keylower","fielddata":true}},"copy_to":["all_fields"],"analyzer":"cs_index_analyzer","search_analyzer":"cs_search_analyzer","fielddata":true},"orgjoindate":{"type":"text","fields":{"raw":{"type":"text","analyzer":"keylower","fielddata":true}},"copy_to":["all_fields"],"analyzer":"cs_index_analyzer","search_analyzer":"cs_search_analyzer","fielddata":true},"roles":{"type":"text","fields":{"raw":{"type":"text","analyzer":"keylower","fielddata":true}},"copy_to":["all_fields"],"analyzer":"cs_index_analyzer","search_analyzer":"cs_search_analyzer","fielddata":true},"updatedDate":{"type":"text","fields":{"raw":{"type":"text","analyzer":"keylower","fielddata":true}},"copy_to":["all_fields"],"analyzer":"cs_index_analyzer","search_analyzer":"cs_search_analyzer","fielddata":true},"userId":{"type":"text","fields":{"raw":{"type":"text","analyzer":"keylower","fielddata":true}},"copy_to":["all_fields"],"analyzer":"cs_index_analyzer","search_analyzer":"cs_search_analyzer","fielddata":true}}},"phone":{"type":"text","fields":{"raw":{"type":"text","analyzer":"keylower","fielddata":true}},"copy_to":["all_fields"],"analyzer":"cs_index_analyzer","search_analyzer":"cs_search_analyzer","fielddata":true},"phoneVerified":{"type":"boolean","fields":{"raw":{"type":"boolean"}}},"phoneverified":{"type":"boolean","fields":{"raw":{"type":"boolean"}}},"profileVisibility":{"properties":{"address":{"type":"text","fields":{"raw":{"type":"text","analyzer":"keylower","fielddata":true}},"copy_to":["all_fields"],"analyzer":"cs_index_analyzer","search_analyzer":"cs_search_analyzer","fielddata":true},"firstName":{"type":"text","fields":{"raw":{"type":"text","analyzer":"keylower","fielddata":true}},"copy_to":["all_fields"],"analyzer":"cs_index_analyzer","search_analyzer":"cs_search_analyzer","fielddata":true},"gender":{"type":"text","fields":{"raw":{"type":"text","analyzer":"keylower","fielddata":true}},"copy_to":["all_fields"],"analyzer":"cs_index_analyzer","search_analyzer":"cs_search_analyzer","fielddata":true},"location":{"type":"text","fields":{"raw":{"type":"text","analyzer":"keylower","fielddata":true}},"copy_to":["all_fields"],"analyzer":"cs_index_analyzer","search_analyzer":"cs_search_analyzer","fielddata":true}}},"roles":{"type":"text","fields":{"raw":{"type":"text","analyzer":"keylower","fielddata":true}},"copy_to":["all_fields"],"analyzer":"cs_index_analyzer","search_analyzer":"cs_search_analyzer","fielddata":true},"rootOrgId":{"type":"text","fields":{"raw":{"type":"text","analyzer":"keylower","fielddata":true}},"copy_to":["all_fields"],"analyzer":"cs_index_analyzer","search_analyzer":"cs_search_analyzer","fielddata":true},"rootOrgName":{"type":"text","fields":{"raw":{"type":"text","analyzer":"keylower","fielddata":true}},"copy_to":["all_fields"],"analyzer":"cs_index_analyzer","search_analyzer":"cs_search_analyzer","fielddata":true},"skills":{"properties":{"createdBy":{"type":"text","fields":{"raw":{"type":"text","analyzer":"keylower","fielddata":true}},"copy_to":["all_fields"],"analyzer":"cs_index_analyzer","search_analyzer":"cs_search_analyzer","fielddata":true},"createdOn":{"type":"date","fields":{"raw":{"type":"date"}}},"endorsementCount":{"type":"long","fields":{"raw":{"type":"long"}}},"endorsersList":{"properties":{"endorseDate":{"type":"date","fields":{"raw":{"type":"date"}}},"userId":{"type":"text","fields":{"raw":{"type":"text","analyzer":"keylower","fielddata":true}},"copy_to":["all_fields"],"analyzer":"cs_index_analyzer","search_analyzer":"cs_search_analyzer","fielddata":true}}},"id":{"type":"text","fields":{"raw":{"type":"text","analyzer":"keylower","fielddata":true}},"copy_to":["all_fields"],"analyzer":"cs_index_analyzer","search_analyzer":"cs_search_analyzer","fielddata":true},"lastUpdatedBy":{"type":"text","fields":{"raw":{"type":"text","analyzer":"keylower","fielddata":true}},"copy_to":["all_fields"],"analyzer":"cs_index_analyzer","search_analyzer":"cs_search_analyzer","fielddata":true},"lastUpdatedOn":{"type":"date","fields":{"raw":{"type":"date"}}},"skillName":{"type":"text","fields":{"raw":{"type":"text","analyzer":"keylower","fielddata":true}},"copy_to":["all_fields"],"analyzer":"cs_index_analyzer","search_analyzer":"cs_search_analyzer","fielddata":true},"skillNameToLowercase":{"type":"text","fields":{"raw":{"type":"text","analyzer":"keylower","fielddata":true}},"copy_to":["all_fields"],"analyzer":"cs_index_analyzer","search_analyzer":"cs_search_analyzer","fielddata":true},"userId":{"type":"text","fields":{"raw":{"type":"text","analyzer":"keylower","fielddata":true}},"copy_to":["all_fields"],"analyzer":"cs_index_analyzer","search_analyzer":"cs_search_analyzer","fielddata":true}}},"status":{"type":"long","fields":{"raw":{"type":"long"}}},"updatedBy":{"type":"text","fields":{"raw":{"type":"text","analyzer":"keylower","fielddata":true}},"copy_to":["all_fields"],"analyzer":"cs_index_analyzer","search_analyzer":"cs_search_analyzer","fielddata":true},"updatedDate":{"type":"text","fields":{"raw":{"type":"text","analyzer":"keylower","fielddata":true}},"copy_to":["all_fields"],"analyzer":"cs_index_analyzer","search_analyzer":"cs_search_analyzer","fielddata":true},"userId":{"type":"text","fields":{"raw":{"type":"text","analyzer":"keylower","fielddata":true}},"copy_to":["all_fields"],"analyzer":"cs_index_analyzer","search_analyzer":"cs_search_analyzer","fielddata":true},"userName":{"type":"text","fields":{"raw":{"type":"text","analyzer":"keylower","fielddata":true}},"copy_to":["all_fields"],"analyzer":"cs_index_analyzer","search_analyzer":"cs_search_analyzer","fielddata":true},"userType":{"type":"text","fields":{"raw":{"type":"text","analyzer":"keylower","fielddata":true}},"copy_to":["all_fields"],"analyzer":"cs_index_analyzer","search_analyzer":"cs_search_analyzer","fielddata":true}}}}}}
    
    
    example
    curl -X GET \
    http://localhost:9200/searchindex/_mapping/user \
    -H 'cache-control: no-cache
</code>
</pre>

<h3 id="prepare-the-mapping-as-input-to-create-index">Prepare the mapping as input to create index</h3>

<ul>
  <li>Copy the inner json of the index starting from mapping as root</li>
  <li>change the original type name to _doc as per 6.x convention</li>
  <li>Enabling [_all] is disabled in 6.0. hence we need to remove that configuration (“_all”:{“enabled”:true})</li>
  <li>for searchindex the mapping type needs to be static, hence dynamic field should be set to false and dynamic_template field should be removed.</li>
</ul>

<p>Once we have the settings and mappings prepared we can create index with the settings, refer <a href="https://project-sunbird.atlassian.net/wiki/spaces/SBDES/pages/1024589843/Sunbird+Elasticsearch+migration+to+multi+index">Solution Approach</a></p>

<h3 id="creating-indexes-through-curl-commands">Creating indexes through cURL commands</h3>

<pre>
  <code>    Elasticsearch mapping update job steps
    cd sunbird-utils/elasticsearch-util/src/main/resources/indices
    curl -X PUT http://{es-ip}:{es-port}/user -H 'Content-Type: application/json' -d @user.json
    curl -X PUT http://{es-ip}:{es-port}/org -H 'Content-Type: application/json' -d @org.json
    curl -X PUT http://{es-ip}:{es-port}/location -H 'Content-Type: application/json' -d @location.json
    curl -X PUT http://{es-ip}:{es-port}/usernotes -H 'Content-Type: application/json' -d @usernotes.json
    curl -X PUT http://{es-ip}:{es-port}/badgeassociations -H 'Content-Type: application/json' -d @badgeassociations.json
    curl -X PUT http://{es-ip}:{es-port}/cbatch -H 'Content-Type: application/json' -d @cbatch.json

    curl -X PUT http://{es-ip}:{es-port}/cbatchstats -H 'Content-Type: application/json' -d @cbatchstats.json
    curl -X PUT http://{es-ip}:{es-port}/userprofilevisibility -H 'Content-Type: application/json' -d @userprofilevisibility.json
    curl -X PUT http://{es-ip}:{es-port}/usercourses -H 'Content-Type: application/json' -d @usercourses.json
    curl -X PUT http://{es-ip}:{es-port}/announcement -H 'Content-Type: application/json' -d @announcement.json
    curl -X PUT http://{es-ip}:{es-port}/announcementtype -H 'Content-Type: application/json' -d @announcementtype.json
    curl -X PUT http://{es-ip}:{es-port}/metrics -H 'Content-Type: application/json' -d @metrics.json
</code>
</pre>

<h3 id="migrate-old-index-data">Migrate old index data</h3>

<p>The old data can be migrated to multiple types data to new indexes with single type</p>

<ul>
  <li>reindex API in elasticsearch</li>
  <li>sync functionality in sunbird</li>
</ul>

<h3 id="pros-and-cons">Pros and Cons</h3>

<table>
  <thead>
    <tr>
      <th>Approach</th>
      <th>Pros</th>
      <th>Cons</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>sync flow</td>
      <td> </td>
      <td>need to modify to include support for all types</td>
    </tr>
    <tr>
      <td>reindex API</td>
      <td>can apply settings like size, throttling etc. <br />no involvement of sunbird application</td>
      <td> </td>
    </tr>
  </tbody>
</table>

<h3 id="reindex-api-to-migrate-data">Reindex API to migrate data</h3>

<p>POST /_reindex call can be made with proper arguments</p>

<pre>
  <code>reindex API

    Request
    
    POST /_reindex
    {
    "source": {
        "index": "{oldIndexName}",
        "type": "{type}"
    },
    "dest": {
        "index": "{newIndexName}",
        "type" : "_doc"
    }
    }
    
    Response
    
    {
        "took": 632,
        "timed_out": false,
        "total": 114,
        "updated": 0,
        "created": 114,
        "deleted": 0,
        "batches": 1,
        "version_conflicts": 0,
        "noops": 0,
        "retries": {
            "bulk": 0,
            "search": 0
        },
        "throttled_millis": 0,
        "requests_per_second": -1,
        "throttled_until_millis": 0,
        "failures": []
    }
    
    
    example
    
    curl -X POST \
    http://localhost:9200/_reindex \
    -H 'Content-Type: application/json' \
    -H 'cache-control: no-cache' \
    -d '{
    "source": {
        "index": "searchindex",
        "type": "org"
    },
    "dest": {
        "index": "org",
        "type" : "_doc"
    }
    }'
</code>
</pre>

<h3 id="additional-details">Additional details</h3>

<p>The reindex API need to be called for</p>

<ul>
  <li>user</li>
  <li>organization</li>
  <li>usercourses</li>
  <li>cbatch</li>
  <li>badgeassociations</li>
  <li>usernotes</li>
  <li>userprofilevisibility</li>
  <li>location</li>
</ul>

<h4 id="curl-command-for-reindex-data-from-old-index-to-new">cURL command for reindex data from old index to new</h4>

<pre>
  <code>reindex curl command

    curl -X POST http://{es-ip}:{es-port}/_reindex -H 'Content-Type: application/json' -d '{"source":{"index":"searchindex","type":"user"},"dest":{"index":"user","type":"_doc"}}'
    curl -X POST http://{es-ip}:{es-port}/_reindex -H 'Content-Type: application/json' -d '{"source":{"index":"searchindex","type":"org"},"dest":{"index":"org","type":"_doc"}}'
    curl -X POST http://{es-ip}:{es-port}/_reindex -H 'Content-Type: application/json' -d '{"source":{"index":"searchindex","type":"location"},"dest":{"index":"location","type":"_doc"}}'
    curl -X POST http://{es-ip}:{es-port}/_reindex -H 'Content-Type: application/json' -d '{"source":{"index":"searchindex","type":"usernotes"},"dest":{"index":"usernotes","type":"_doc"}}'
    curl -X POST http://{es-ip}:{es-port}/_reindex -H 'Content-Type: application/json' -d '{"source":{"index":"searchindex","type":"badgeassociations"},"dest":{"index":"badgeassociations","type":"_doc"}}'
    curl -X POST http://{es-ip}:{es-port}/_reindex -H 'Content-Type: application/json' -d '{"source":{"index":"searchindex","type":"cbatch"},"dest":{"index":"cbatch","type":"_doc"}}'
    curl -X POST http://{es-ip}:{es-port}/_reindex -H 'Content-Type: application/json' -d '{"source":{"index":"searchindex","type":"userprofilevisibility"},"dest":{"index":"userprofilevisibility","type":"_doc"}}'
    curl -X POST http://{es-ip}:{es-port}/_reindex -H 'Content-Type: application/json' -d '{"source":{"index":"searchindex","type":"usercourses"},"dest":{"index":"usercourses","type":"_doc"}}'
    curl -X POST http://{es-ip}:{es-port}/_reindex -H 'Content-Type: application/json' -d '{"source":{"index":"sunbirdplugin","type":"announcement"},"dest":{"index":"announcement","type":"_doc"}}'
    curl -X POST http://{es-ip}:{es-port}/_reindex -H 'Content-Type: application/json' -d '{"source":{"index":"sunbirdplugin","type":"announcementtype"},"dest":{"index":"announcementtype","type":"_doc"}}'
    curl -X POST http://{es-ip}:{es-port}/_reindex -H 'Content-Type: application/json' -d '{"source":{"index":"sunbirdplugin","type":"metrics"},"dest":{"index":"metrics","type":"_doc"}}'
</code>
</pre>

<h3 id="open-questions">Open Questions</h3>

<p>1.sunbirddataaudit index is used to log some of the request auditing in elasticsearch. Is it still needed and supported with new multi index way. (AuditLogActions.java has details of which API being audited currently)</p>

<p>2.sunbirdplugin index is used based on the API call, the type is passed into the request. need discussion as how to support it in new multi index format.</p>

<p>3.Currently health check url for elasticsearch checks if “searchindex” exists or not, since we are having multiple index for different entity how do we verify health check for elasticsearch? do we just check user index or all indexes or some other way.</p>

          
          <hr />
          
          <p class="edit-para text-right">
			<a target="_blank" href="https://github.com/project-sunbird/sunbird.org-docs/edit/master/developer-docs/migration/index.md" title="Fix this page">
				<i class="fa fa-pencil-square-o" aria-hidden="true"></i> Edit</a> |
			<a target="_blank" href="https://github.com/project-sunbird/sunbird.org-docs/issues" title="Report issue">
				<i class="fa fa-exclamation-circle" aria-hidden="true"></i> Report</a>
		  </p>
		  <a href="developer-docs/migration/#heading" class="scrollup"><i class="fa fa-arrow-circle-up" aria-hidden="true"></i></a>
          
      </div>
    </div>
    <div class="page-footer">
		<footer class="footer">
	<div class="footer__top">
		<div class="container">
			<div class="row">
				
			<div class="col-md-4 col-sm-12">
			</div>
			
			<div class="col-md-2 col-sm-6 ">
				<ul>
					<li><a href="http://www.sunbird.org/about/" target="_blank">About Sunbird</a></li>
					<li><a href="http://www.sunbird.org/contact/" target="_blank">Contact Us</a></li>
				</ul>
			</div>
			
			<div class="col-md-2 col-sm-6 sideline">
				<ul>
					<li><a href="http://www.sunbird.org/privacy-policy/" target="_blank">Privacy Policy</a></li>
					<li><a href="http://www.sunbird.org/features/" target="_blank">Microservices</a></li>
				</ul>
			</div>

			<div class="col-md-2 col-sm-12">
			</div>
			
		</div>
	</div>
</footer>
 

	</div>
  </div>
  <script type="text/javascript">
	//TOC Toggle
    $(function() {
        $.toc.clickHideButton();
    });
    //Scroll to top
    $(document).ready(function () {
		$(".content").scroll(function () {
			if ($(this).scrollTop() > 250) {
				$('.scrollup').fadeIn();
			} else {
				$('.scrollup').fadeOut();
			}
		});
	});
	$('#toc a').each(function(){
		var url = this.href.replace(baseURL.href, "");
		this.href = 'developer-docs/migration/' + url;
    })
	$(".zoomcover").click(function(){
		if (!$(this).hasClass("fullscreen")){
			$(this).addClass("fullscreen");
			$(this).find(".zoom").addClass("enabled").elevateZoom({
				zoomType: "inner",
				cursor  : "crosshair",
				scrollZoom: "true"
			});
		} else {
			$(this).removeClass("fullscreen");
			$(this).find(".zoom").removeClass("enabled");
			$(".zoomContainer").hide();
		}
	});
	$(document).keyup(function(e) {
     if (e.keyCode == 27) { 
		$(".zoomcover").removeClass("fullscreen");
		$(".zoomcover").find(".zoom").removeClass("enabled");
		$(".zoomContainer").hide();
    }
});
  </script>
  <style>
  .zoom:hover{
	cursor:url(/img/zoom.png),crosshair;
  }
  .zoomWindowContainer:hover div{
	cursor:url(/img/scroll.png),crosshair !important;
	height:15px;
	width:15px;
  }
  </style>
  <div id="templates"></div>
  </body>
</html>
